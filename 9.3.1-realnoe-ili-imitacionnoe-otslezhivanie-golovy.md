# 9.3.1 Реальное или имитационное отслеживание головы

В главе, посвященной моделям URDF, мы использовали пакет `arbotix_python` в искусственном режиме для проверки движения смоделированных сервоприводов Dynamixel. При использовании имитатора для отслеживания головы, оказывается, что наша техника отслеживания скорости заставляет голову качаться вокруг цели. Это происходит потому, что искусственная камера, сервоприводы и другие компоненты робота не имеют инерции для гашения движения. Следовательно, при использовании искусственного робота нам нужно использовать отслеживание положения, а не скорости. Отслеживание положения использует фиксированную скорость сервопривода и направляет камеру прямо на цель. Напомним, что, напротив, слежение за скоростью направляет камеру впереди цели, но регулирует скорость так, чтобы она была пропорциональна смещению цели из центра поля зрения. Использование отслеживания положения с реальным оборудованием вызывает рывковое движение сервоприводов, поэтому мы используем вместо этого отслеживание скорости. Однако для искусственного робота отслеживание положения работает нормально. Рядом с верхней частью скрипта отслеживания положения вы увидите следующие строки:

```text
# Are we running in fake mode?
FAKE = rospy.get_param('~sim', False)
```

```text
# For fake mode we use the arbotix controller package and position tracking
if FAKE:
 CONTROLLER_TYPE = 'arbotix'
 TRACKER_TYPE = 'position'
else:
 # Specify either 'dynamixel_motor' or 'arbotix' for the controller package
 CONTROLLER_TYPE = rospy.get_param('~controller_type', 'arbotix')

 # Specify either 'speed' or 'position' for the type of tracking
 TRACKER_TYPE = rospy.get_param('~tracker_type', 'speed')
```

Установив параметр `sim` в файле `head_tracker.launch` в значение `True`, мы можем запустить отслеживание головы в симуляторе `ArbotiX` с помощью позиционного трекинга. При использовании реальных сервоприводов установите этот параметр в `False` и вместо него будет использоваться отслеживание скорости. Далее в скрипте `head_tracker.py` тип контроллера и тип трекера определяют обратный вызов, который мы выполняем на целевом типе `PoseStamped`:

```text
 if CONTROLLER_TYPE == 'arbotix' and TRACKER_TYPE == 'position':
rospy.Subscriber('target_topic', PoseStamped, self.update_joint_positions)
 else: rospy.Subscriber('target_topic', PoseStamped,
self.update_joint_speeds)
```

Как видите, для имитации отслеживания головы `controller_type='arbotix' и tracker_type='position'`мы используем обратный вызов `update_joint_position()`, в то время как для реального отслеживания мы используем обратный вызов `update_joint_speeds()- update_joint_speeds()`. Обратите внимание, как мы используем общее имя темы 'target\_topic', которое затем может быть перенаправлено в файл запуска на конкретную тему, которую мы хотим отследить.

